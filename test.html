<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Entry Booking Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .btn {
            padding: 12px 24px;
            background: #f97316;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }

        .btn:hover {
            background: #ea580c;
        }

        .btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .status {
            margin: 10px 0;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .status.error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .debug-info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üêõ Debug - Entry Booking Widget Test</h1>
        <p>This page is designed to test and debug the entry booking functionality step by step.</p>

        <div class="test-section">
            <h2>1. Widget Loading Test</h2>
            <p>First, let's check if the widget loads properly.</p>
            <button onclick="testWidgetLoad()" class="btn">Test Widget Load</button>
            <div id="load-status"></div>
        </div>

        <div class="test-section">
            <h2>2. Bookables List Test</h2>
            <p>Test the universal bookables list with different configurations.</p>

            <h3>üè¢ Lagos Location (ID: 1)</h3>
            <button onclick="testLagosBookables()" class="btn">Show Lagos Bookables</button>

            <h3>üèîÔ∏è Enugu Location (ID: 2)</h3>
            <button onclick="testEnuguBookables()" class="btn">Show Enugu Bookables</button>

            <div id="bookables-status"></div>
        </div>

        <div class="test-section">
            <h2>3. Direct Entry Booking Test</h2>
            <p>Skip bookables selection and go directly to entry booking.</p>

            <button onclick="testDirectEntry(1)" class="btn">Direct Entry - Lagos</button>
            <button onclick="testDirectEntry(2)" class="btn">Direct Entry - Enugu</button>

            <div id="entry-status"></div>
        </div>

        <div class="test-section">
            <h2>4. API Endpoints Test</h2>
            <p>Test the actual API endpoints to see what's working.</p>

            <button onclick="testApiEndpoints()" class="btn">Test API Endpoints</button>
            <div id="api-status"></div>
            <div id="api-results" class="debug-info" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>5. Debug Information</h2>
            <button onclick="showDebugInfo()" class="btn">Show Debug Info</button>
            <div id="debug-info"></div>
        </div>

        <div id="global-status"></div>
    </div>

    <!-- Load the Universal Booking Widget -->
    <script src="dist//universal-booking-widget.min.js"></script>

    <script>
        // Utility functions
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
            }
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function appendStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                const statusDiv = document.createElement('div');
                statusDiv.className = `status ${type}`;
                statusDiv.textContent = message;
                element.appendChild(statusDiv);
            }
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Test 1: Widget Loading
        function testWidgetLoad() {
            updateStatus('load-status', 'Testing widget load...', 'info');

            setTimeout(() => {
                if (window.UniversalBookingWidget) {
                    updateStatus('load-status', '‚úÖ Widget loaded successfully!', 'success');

                    // Check supported business types
                    try {
                        const supportedTypes = UniversalBookingWidget.getSupportedBusinessTypes();
                        appendStatus('load-status', `Supported types: ${supportedTypes.join(', ')}`, 'info');
                    } catch (error) {
                        appendStatus('load-status', `Error getting supported types: ${error.message}`, 'error');
                    }
                } else {
                    updateStatus('load-status', '‚ùå Widget failed to load', 'error');
                }
            }, 500);
        }

        // Test 2: Lagos Bookables
        function testLagosBookables() {
            updateStatus('bookables-status', 'Opening Lagos bookables...', 'info');

            try {
                const widget = UniversalBookingWidget.init({
                    businessType: null, // Show bookables list
                    locationId: 1,
                    bookables: ['entry', 'hotel', 'udh', 'furniture'],
                    branding: {
                        primaryColor: '#f97316',
                        companyName: 'Landmark Lagos',
                        locationName: 'Landmark Oniru Lagos, Nigeria',
                        locationImage: "https://pbs.twimg.com/media/GfgQsLwXIAA6aCQ?format=jpg&name=large",
                        description: "The premier event and leisure destination in Lagos."
                    },
                    autoShow: true
                });

                widget.open();
                updateStatus('bookables-status', '‚úÖ Lagos bookables opened', 'success');
            } catch (error) {
                updateStatus('bookables-status', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Test 3: Enugu Bookables
        function testEnuguBookables() {
            updateStatus('bookables-status', 'Opening Enugu bookables...', 'info');

            try {
                const widget = UniversalBookingWidget.init({
                    businessType: null,
                    locationId: 2,
                    bookables: ['entry', 'hotel', 'udh', 'furniture'],
                    branding: {
                        primaryColor: '#f97316',
                        companyName: 'Nike Lake Resort - Enugu',
                        locationName: 'Nike Lake Resort, Enugu',
                        locationImage: "https://pbs.twimg.com/profile_images/1902362596965007360/epM_0g3-_400x400.jpg",
                        description: "A serene getaway nestled in the hills of Enugu."


                    },
                    autoShow: true
                });

                widget.open();
                updateStatus('bookables-status', '‚úÖ Enugu bookables opened', 'success');
            } catch (error) {
                updateStatus('bookables-status', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Test 4: Direct Entry Booking
        function testDirectEntry(locationId) {
            const locationName = locationId === 1 ? 'Lagos' : 'Enugu';
            updateStatus('entry-status', `Opening direct entry booking for ${locationName}...`, 'info');

            try {
                const widget = UniversalBookingWidget.init({
                    businessType: 'entry',
                    locationId: locationId,
                    branding: {
                        primaryColor: '#f97316',
                        companyName: `Nike Lake Resort - ${locationName}`
                    },
                    autoShow: true
                });

                widget.open();
                updateStatus('entry-status', `‚úÖ Direct entry opened for ${locationName}`, 'success');
            } catch (error) {
                updateStatus('entry-status', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Test 5: API Endpoints
        async function testApiEndpoints() {
            updateStatus('api-status', 'Testing API endpoints...', 'info');
            document.getElementById('api-results').style.display = 'block';

            const results = {};

            // Test Lagos entry types
            try {
                updateStatus('api-results', 'Testing Lagos entry types...', 'info');
                const response1 = await fetch('http://127.0.0.1:8000/api/booking/entry/type?landmark_location_id=1');
                results.lagosTypes = {
                    status: response1.status,
                    ok: response1.ok,
                    data: response1.ok ? await response1.json() : await response1.text()
                };
                appendStatus('api-status', `Lagos types: ${response1.status} ${response1.ok ? '‚úÖ' : '‚ùå'}`, response1.ok ? 'success' : 'error');
            } catch (error) {
                results.lagosTypes = { error: error.message };
                appendStatus('api-status', `Lagos types error: ${error.message}`, 'error');
            }

            // Test Enugu entry types
            try {
                updateStatus('api-results', 'Testing Enugu entry types...', 'info');
                const response2 = await fetch('http://127.0.0.1:8000/api/booking/entry/type?landmark_location_id=2');
                results.enuguTypes = {
                    status: response2.status,
                    ok: response2.ok,
                    data: response2.ok ? await response2.json() : await response2.text()
                };
                appendStatus('api-status', `Enugu types: ${response2.status} ${response2.ok ? '‚úÖ' : '‚ùå'}`, response2.ok ? 'success' : 'error');
            } catch (error) {
                results.enuguTypes = { error: error.message };
                appendStatus('api-status', `Enugu types error: ${error.message}`, 'error');
            }

            // Test entry items (if we have a valid type ID)
            if (results.lagosTypes?.ok && results.lagosTypes.data?.[0]?.id) {
                try {
                    const typeId = results.lagosTypes.data[0].id;
                    updateStatus('api-results', `Testing entry items for type ${typeId}...`, 'info');
                    const response3 = await fetch(`http://127.0.0.1:8000/api/booking/entry/items?type_id=${typeId}&platform=web`);
                    results.entryItems = {
                        status: response3.status,
                        ok: response3.ok,
                        data: response3.ok ? await response3.json() : await response3.text()
                    };
                    appendStatus('api-status', `Entry items: ${response3.status} ${response3.ok ? '‚úÖ' : '‚ùå'}`, response3.ok ? 'success' : 'error');
                } catch (error) {
                    results.entryItems = { error: error.message };
                    appendStatus('api-status', `Entry items error: ${error.message}`, 'error');
                }
            }

            // Display full results
            document.getElementById('api-results').innerHTML = '<h4>üìä API Test Results:</h4><pre>' + JSON.stringify(results, null, 2) + '</pre>';
        }

        // Test 6: Debug Information
        function showDebugInfo() {
            const debugInfo = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                windowLocation: window.location.href,
                widgetLoaded: !!window.UniversalBookingWidget,
                supportedTypes: window.UniversalBookingWidget ? window.UniversalBookingWidget.getSupportedBusinessTypes() : 'Widget not loaded',
                sessionStorage: {
                    selectedBusinessType: sessionStorage.getItem('selectedBusinessType'),
                    isReloading: sessionStorage.getItem('isReloading')
                },
                currentInstances: window.UniversalBookingWidget ? Object.keys(window.UniversalBookingWidget.instances || {}) : 'No instances'
            };

            document.getElementById('debug-info').innerHTML =
                '<div class="debug-info"><h4>üêõ Debug Information:</h4><pre>' +
                JSON.stringify(debugInfo, null, 2) +
                '</pre></div>';
        }

        // Auto-load test
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(() => {
                updateStatus('global-status', 'Page loaded. Click tests above to debug issues.', 'info');
                testWidgetLoad(); // Auto-run basic test
            }, 1000);
        });

        // Global error handler
        window.addEventListener('error', function (event) {
            console.error('Global error:', event.error);
            appendStatus('global-status', `Global error: ${event.error?.message || event.message}`, 'error');
        });

        // Console override for better debugging
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            // Also show important logs in the UI
            const message = args.join(' ');
            if (message.includes('EntryAdapter') || message.includes('UniversalBookablesList') || message.includes('Error')) {
                const logDiv = document.createElement('div');
                logDiv.className = 'status info';
                logDiv.style.fontSize = '11px';
                logDiv.style.opacity = '0.7';
                logDiv.textContent = `Console: ${message}`;
                document.getElementById('global-status').appendChild(logDiv);
            }
        };
    </script>
</body>

</html>